<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ProctorAI Dashboard</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: Arial, sans-serif;
      background: #f5f5f5;
      color: #333;
    }

    /* Header */
    .header {
      background: white;
      border-bottom: 1px solid #ddd;
      padding: 12px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .header h2 { font-size: 15px; }
    .header #timer { font-size: 18px; font-weight: bold; }
    .btn {
      padding: 6px 14px;
      border-radius: 4px;
      cursor: pointer;
      font-size: 13px;
      border: 1px solid #ccc;
      background: white;
      margin-left: 8px;
    }
    .btn-red  { border-color: red; color: red; }
    .btn-dark { background: #333; color: white; border-color: #333; }

    /* Stats Bar */
    .stats {
      display: flex;
      gap: 12px;
      padding: 14px 20px;
    }
    .stat {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px 16px;
      flex: 1;
      text-align: center;
    }
    .stat .label { font-size: 11px; color: #888; margin-bottom: 4px; }
    .stat .value { font-size: 20px; font-weight: bold; }
    .red    { color: #e74c3c; }
    .orange { color: #e67e22; }
    .green  { color: #27ae60; }

    /* Pages */
    .page { display: none; padding: 0 20px 20px; }
    .page.active { display: block; }

    /* Layout */
    .layout {
      display: flex;
      gap: 16px;
      align-items: flex-start;
    }
    .left  { flex: 0 0 60%; }
    .right { flex: 1; position: sticky; top: 70px; }

    .section-title {
      font-size: 14px;
      font-weight: bold;
      margin-bottom: 10px;
      color: #555;
    }

    /* Student Cards */
    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(160px, 1fr));
      gap: 10px;
    }
    .card {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .card.warn   { border-color: #f0ad4e; }
    .card.danger { border-color: #e74c3c; }



    .card-body { padding: 8px 10px; }
    .card-name  { font-size: 12px; font-weight: bold; margin-bottom: 4px; }
    .card-badge {
      display: inline-block;
      font-size: 10px;
      padding: 2px 7px;
      border-radius: 99px;
      font-weight: 600;
    }
    .badge-green  { background: #e9f7ef; color: #27ae60; }
    .badge-orange { background: #fef9e7; color: #e67e22; }
    .badge-red    { background: #fdedec; color: #e74c3c; }
    .card-meta { font-size: 10px; color: #999; margin-top: 4px; }

    /* Risk Table */
    .panel {
      background: white;
      border: 1px solid #ddd;
      border-radius: 6px;
      overflow: hidden;
    }
    .panel-header {
      padding: 10px 14px;
      border-bottom: 1px solid #eee;
      font-weight: bold;
      font-size: 13px;
    }
    table { width: 100%; border-collapse: collapse; }
    th {
      font-size: 11px;
      color: #888;
      text-transform: uppercase;
      padding: 8px 14px;
      text-align: left;
      background: #fafafa;
      border-bottom: 1px solid #eee;
    }
    td {
      padding: 8px 14px;
      font-size: 13px;
      border-bottom: 1px solid #eee;
    }
    tr:last-child td { border-bottom: none; }
    tr:hover td { background: #fafafa; }

    /* Audit Page */
    .filter-bar {
      display: flex;
      gap: 10px;
      margin-bottom: 14px;
      flex-wrap: wrap;
    }
    input[type="text"], select {
      padding: 7px 12px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 13px;
    }
    input[type="text"] { flex: 1; min-width: 200px; }

    /* Flash new row */
    .new-row td { animation: flash 0.8s ease; }
    @keyframes flash { from { background: #fffde7; } to { background: white; } }

    /* Toast */
    #toast {
      position: fixed;
      bottom: 20px; right: 20px;
      background: #333;
      color: white;
      padding: 10px 16px;
      border-radius: 6px;
      font-size: 13px;
      opacity: 0;
      transition: opacity 0.3s;
      z-index: 999;
    }
    #toast.show { opacity: 1; }
  </style>
</head>
<body>

<!-- HEADER -->
<div class="header">
  <h2>üìã Exam: Operating Systems 101</h2>
  <span id="timer">01:29:58</span>
  <div>
    <span style="font-size:13px; color:#666;">Candidates: <b>42</b></span>
    <button class="btn btn-dark" onclick="toggleView()">Audit Report ‚Üí</button>
    <button class="btn btn-red">Logout</button>
  </div>
</div>

<!-- STATS -->
<div class="stats">
  <div class="stat"><div class="label">Active</div>    <div class="value green"  id="s-active">42</div></div>
  <div class="stat"><div class="label">Flagged</div>   <div class="value red"    id="s-flagged">0</div></div>
  <div class="stat"><div class="label">Warnings</div>  <div class="value orange" id="s-warnings">0</div></div>
  <div class="stat"><div class="label">Total Events</div><div class="value"      id="s-events">0</div></div>
</div>

<!-- PAGE 1: DASHBOARD -->
<div id="page-dash" class="page active">
  <div class="layout">

    <!-- Left: Student Cards -->
    <div class="left">
      <div class="section-title">üë• Live Student Monitor</div>
      <div class="grid" id="studentGrid"></div>
    </div>

    <!-- Right: Risk Leaderboard -->
    <div class="right">
      <div class="panel">
        <div class="panel-header">‚ö†Ô∏è Risk Leaderboard</div>
        <table>
          <thead>
            <tr><th>#</th><th>Student</th><th>Events</th><th>Score</th></tr>
          </thead>
          <tbody id="riskBody"></tbody>
        </table>
      </div>
    </div>

  </div>
</div>

<!-- PAGE 2: AUDIT REPORT -->
<div id="page-audit" class="page">
  <div class="filter-bar">
    <input type="text" id="searchInput" placeholder="üîç Filter by student name‚Ä¶" oninput="renderAudit()">
    <select id="typeFilter" onchange="renderAudit()">
      <option value="">All Event Types</option>
      <option>Tab Switch</option>
      <option>Face Not Detected</option>
      <option>Multiple Faces</option>
      <option>Audio Detected</option>
      <option>Browser Blur</option>
      <option>Phone Detected</option>
    </select>
    <button class="btn btn-dark" onclick="exportCSV()">‚Üì Export CSV</button>
  </div>

  <div class="panel">
    <table>
      <thead>
        <tr><th>Time</th><th>Student</th><th>Event</th><th>Confidence</th><th>Impact</th></tr>
      </thead>
      <tbody id="auditBody"></tbody>
    </table>
  </div>
</div>

<!-- Toast notification -->
<div id="toast"></div>

<script>
  // ‚îÄ‚îÄ Student list ‚îÄ‚îÄ
  var students = [
    { id:1, name:"Arjun Mehta",   score:0, events:0, status:"Normal" },
    { id:2, name:"Priya Sharma",  score:0, events:0, status:"Normal" },
    { id:3, name:"Rahul Singh",   score:0, events:0, status:"Normal" },
    { id:4, name:"Sneha Gupta",   score:0, events:0, status:"Normal" },
    { id:5, name:"Karan Patel",   score:0, events:0, status:"Normal" },
    { id:6, name:"Ananya Reddy",  score:0, events:0, status:"Normal" },
    { id:7, name:"Vikram Nair",   score:0, events:0, status:"Normal" },
    { id:8, name:"Pooja Iyer",    score:0, events:0, status:"Normal" },
  ];

  // ‚îÄ‚îÄ Event types ‚îÄ‚îÄ
  var eventTypes = [
    { type:"Tab Switch",        impact:30, level:"danger" },
    { type:"Face Not Detected", impact:20, level:"danger" },
    { type:"Multiple Faces",    impact:30, level:"danger" },
    { type:"Audio Detected",    impact:10, level:"warn"   },
    { type:"Browser Blur",      impact:30, level:"warn"   },
    { type:"Phone Detected",    impact:15, level:"danger" },
  ];

  var auditLog = [];
  var view = "dash";

  // ‚îÄ‚îÄ Countdown Timer ‚îÄ‚îÄ
  var secs = 90 * 60 - 2;
  setInterval(function() {
    secs--;
    var h = pad(Math.floor(secs / 3600));
    var m = pad(Math.floor((secs % 3600) / 60));
    var s = pad(secs % 60);
    document.getElementById("timer").textContent = h + ":" + m + ":" + s;
  }, 1000);
  function pad(n) { return String(n).padStart(2, "0"); }

  // ‚îÄ‚îÄ Build student cards ‚îÄ‚îÄ
  function renderCards() {
    var html = "";
    students.forEach(function(s) {
      var cardClass = s.score >= 70 ? "danger" : s.score >= 30 ? "warn" : "";
      var badge = s.score >= 70
        ? '<span class="card-badge badge-red">‚ö† ' + s.status + '</span>'
        : s.score >= 30
        ? '<span class="card-badge badge-orange">‚öë ' + s.status + '</span>'
        : '<span class="card-badge badge-green">‚úì Normal</span>';

      html += '<div class="card ' + cardClass + '">'
            +   '<div class="card-body">'
            +     '<div class="card-name">' + s.name + '</div>'
            +     badge
            +     '<div class="card-meta">Score: ' + s.score + '/100 ¬∑ ' + s.events + ' events</div>'
            +   '</div>'
            + '</div>';
    });
    document.getElementById("studentGrid").innerHTML = html;
  }

  // ‚îÄ‚îÄ Build risk leaderboard ‚îÄ‚îÄ
  function renderRisk() {
    var sorted = students.slice().sort(function(a, b) { return b.score - a.score; });
    var html = "";
    sorted.forEach(function(s, i) {
      var cls = s.score >= 70 ? "red" : s.score >= 30 ? "orange" : "green";
      html += '<tr>'
            +   '<td>' + (i + 1) + '</td>'
            +   '<td>' + s.name + '</td>'
            +   '<td>' + s.events + '</td>'
            +   '<td class="' + cls + '"><b>' + s.score + '</b></td>'
            + '</tr>';
    });
    document.getElementById("riskBody").innerHTML = html;
  }

  // ‚îÄ‚îÄ Update top stats ‚îÄ‚îÄ
  function updateStats() {
    document.getElementById("s-flagged").textContent  = students.filter(function(s){ return s.score >= 70; }).length;
    document.getElementById("s-warnings").textContent = students.filter(function(s){ return s.score >= 30 && s.score < 70; }).length;
    document.getElementById("s-events").textContent   = auditLog.length;
  }

  // ‚îÄ‚îÄ Show toast popup ‚îÄ‚îÄ
  function showToast(msg) {
    var t = document.getElementById("toast");
    t.textContent = msg;
    t.classList.add("show");
    setTimeout(function() { t.classList.remove("show"); }, 3000);
  }

  // ‚îÄ‚îÄ Simulate a random flag every 5 seconds ‚îÄ‚îÄ
  function simulateFlag() {
    var s    = students[Math.floor(Math.random() * students.length)];
    var e    = eventTypes[Math.floor(Math.random() * eventTypes.length)];
    var conf = Math.floor(Math.random() * 25) + 75; // 75‚Äì99%

    s.score  = Math.min(100, s.score + e.impact);
    s.events = s.events + 1;
    s.status = e.type;

    auditLog.unshift({
      time: new Date().toTimeString().slice(0, 8),
      student: s.name,
      type: e.type,
      level: e.level,
      conf: conf,
      impact: e.impact
    });

    renderCards();
    renderRisk();
    updateStats();
    if (view === "audit") renderAudit(true);

    showToast("üö® " + s.name + " ‚Äî " + e.type + " (" + conf + "%)");
  }

  setInterval(simulateFlag, 5000);

  // ‚îÄ‚îÄ Build audit table ‚îÄ‚îÄ
  function renderAudit(newEntry) {
    var search = (document.getElementById("searchInput").value || "").toLowerCase();
    var filter = document.getElementById("typeFilter").value;

    var list = auditLog.filter(function(e) {
      return e.student.toLowerCase().includes(search) && (!filter || e.type === filter);
    });

    if (list.length === 0) {
      document.getElementById("auditBody").innerHTML =
        '<tr><td colspan="5" style="text-align:center;color:#aaa;padding:30px">No events found.</td></tr>';
      return;
    }

    var html = "";
    list.forEach(function(e, i) {
      var style = e.level === "danger"
        ? "background:#fdedec;color:#e74c3c"
        : "background:#fef9e7;color:#e67e22";
      var rowClass = (newEntry && i === 0) ? ' class="new-row"' : '';
      html += '<tr' + rowClass + '>'
            +   '<td style="color:#aaa;font-size:12px">' + e.time + '</td>'
            +   '<td><b>' + e.student + '</b></td>'
            +   '<td><span style="' + style + ';padding:2px 8px;border-radius:4px;font-size:12px">' + e.type + '</span></td>'
            +   '<td style="font-size:12px">' + e.conf + '%</td>'
            +   '<td style="font-size:12px;color:#e67e22">+' + e.impact + ' pts</td>'
            + '</tr>';
    });
    document.getElementById("auditBody").innerHTML = html;
  }

  // ‚îÄ‚îÄ Switch between Dashboard and Audit ‚îÄ‚îÄ
  function toggleView() {
    var btn = document.querySelector(".btn-dark");
    if (view === "dash") {
      document.getElementById("page-dash").classList.remove("active");
      document.getElementById("page-audit").classList.add("active");
      btn.textContent = "‚Üê Dashboard";
      view = "audit";
      renderAudit();
    } else {
      document.getElementById("page-audit").classList.remove("active");
      document.getElementById("page-dash").classList.add("active");
      btn.textContent = "Audit Report ‚Üí";
      view = "dash";
    }
  }

  // ‚îÄ‚îÄ Export audit log as CSV ‚îÄ‚îÄ
  function exportCSV() {
    var rows = [["Time","Student","Event","Confidence","Impact"]];
    auditLog.forEach(function(e) {
      rows.push([e.time, e.student, e.type, e.conf + "%", "+" + e.impact]);
    });
    var csv = rows.map(function(r){ return r.join(","); }).join("\n");
    var a = document.createElement("a");
    a.href = "data:text/csv," + encodeURIComponent(csv);
    a.download = "audit-report.csv";
    a.click();
  }

  // ‚îÄ‚îÄ Initialize ‚îÄ‚îÄ
  renderCards();
  renderRisk();
  updateStats();
  setTimeout(simulateFlag, 1200);
  setTimeout(simulateFlag, 2800);
</script>
</body>
</html>
